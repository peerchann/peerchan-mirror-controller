name: Mirror Public Repository

on:
  schedule:
    - cron: "0 0 * * *"  # Run daily at midnight (UTC)
  workflow_dispatch:  # Allow manual triggering

jobs:
  mirror:
    runs-on: ubuntu-latest

    steps:
      - name: Clean workspace (ensure no conflicts)
        run: rm -rf source.git

      - name: Clone source repository
        run: git clone --mirror https://gitgud.io/threshold862543/peerchan.git source.git

      - name: Mirror to GitHub
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          cd source.git
          git remote set-url --push origin https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/peerchann/peerchan.git
          # Fetch all updates from source
          git fetch --all
          git push origin --all
          git push origin --tags

      - name: Confirm success
        run: echo "Mirror operation completed successfully!"
        